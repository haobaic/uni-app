(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-socket-index"],{"259d":function(t,e,n){"use strict";var i=n("6b50"),o=n.n(i);o.a},"29c5":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("ac6a");var i={data:function(){return{scrollTop:0,list:[],limit:0,lockReconnect:!1,count:0,massage:"",devtools:"devtools"==uni.getSystemInfoSync().platform}},onLoad:function(){this.linkSocket()},methods:{linkSocket:function(){var t=this;uni.connectSocket({url:"ws://localhost:3000",success:function(){t.initEventHandle()}})},initEventHandle:function(){var e=this,n=this;uni.onSocketOpen(function(){t.log("WebSocket连接打开"),e.message="",uni.sendSocketMessage({data:e.message})}),uni.onSocketError(function(e){t.log("WebSocket连接打开失败"),n.reconnect()}),uni.onSocketClose(function(e){t.log("WebSocket 已关闭！"),n.reconnect()}),uni.onSocketMessage(function(t){var n=JSON.parse(t.data);n.id=e.id++,n.role="server";var i=e.list;i.push(n),e.list=i,e.rollingBottom()})},reconnect:function(){var e=this;e.lockReconnect||(e.lockReconnect=!0,clearTimeout(e.timer),e.limit<10&&(e.timer=setTimeout(function(){e.linkSocket(),e.lockReconnect=!1,t.log("次数:",e.limit)},5e3),e.limit=e.limit+1))},send:function(){if(this.message){wx.sendSocketMessage({data:this.message});var t=this.list;t.push({id:this.count++,content:this.message,role:"me"}),this.list=t,this.message="",this.rollingBottom()}else uni.showToast({title:"消息不能为空哦~",icon:"none",duration:2e3})},scroll:function(e){t.log(e.detail.scrollTo)},bindChange:function(t){this.message=t.detail.value},onUnload:function(){wx.onSocketClose(),wx.showToast({title:"连接已断开~",icon:"none",duration:2e3})},rollingBottom:function(t){var e=this;uni.createSelectorQuery().selectAll(".list").boundingClientRect(function(t){t.forEach(function(t){e.scrollTop=t.bottom})}).exec()}}};e.default=i}).call(this,n("5a52")["default"])},"4f5d":function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,'uni-page-body[data-v-d3a7496c]{background-color:#f7f7f7;height:100%}.chat[data-v-d3a7496c]{padding:%?5?% %?10?%;font-size:14px;line-height:%?80?%;word-break:break-all;margin-bottom:%?100?%;-webkit-box-sizing:border-box;box-sizing:border-box}.wrap[data-v-d3a7496c]{height:100%;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-top:0;-webkit-box-sizing:border-box;box-sizing:border-box}\n\n/* 聊天 */.chat-news[data-v-d3a7496c]{width:100%;overflow:hidden}.news-lf[data-v-d3a7496c]{float:right;padding-right:%?20?%}.chat-news[data-v-d3a7496c]:after{display:block;height:0;clear:both;content:""}.new-rl[data-v-d3a7496c]{float:left;padding-left:%?20?%}.new-img[data-v-d3a7496c]{width:%?60?%;height:%?60?%;border-radius:50%;vertical-align:middle;margin-right:%?10?%}.new-txt[data-v-d3a7496c]{max-width:%?300?%;display:inline-block;border-radius:%?6?%;line-height:%?60?%;background-color:#95d4ff;padding:%?5?% %?20?%;margin:0 %?10?%;margin-left:%?50?%}.new-text[data-v-d3a7496c]{margin-left:0;background:#90ee90}\n\n/* 信息输入区域 */.message[data-v-d3a7496c]{position:fixed;bottom:0;width:100%;height:%?102?%;padding:%?10?%;background-color:#fff;border-top:%?2?% solid #eee;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:3}.message uni-input[data-v-d3a7496c]{float:left;width:76%;height:100%;line-height:%?80?%;padding:0 %?10?%;font-size:%?35?%;color:#666}.message uni-button[data-v-d3a7496c]{float:right;font-size:%?35?%}body.?%PAGE?%[data-v-d3a7496c]{background-color:#f7f7f7}',""])},"6b50":function(t,e,n){var i=n("4f5d");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("edc223ba",i,!0,{sourceMap:!1,shadowMode:!1})},"773e":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-view",{staticClass:"wrap"},[n("v-uni-scroll-view",{staticClass:"chat",attrs:{"scroll-y":"","scroll-top":t.scrollTop},on:{scroll:function(e){e=t.$handleEvent(e),t.scroll(e)}}},[n("v-uni-view",{staticClass:"list"},t._l(t.list,function(e,i){return n("v-uni-view",{key:i,staticClass:"chat-news"},["me"===e.role?[n("v-uni-view",{staticClass:"news-lf"},[n("v-uni-text",{staticClass:"new-txt"},[t._v(t._s(e.content))]),n("v-uni-image",{staticClass:"new-img",attrs:{src:"/static/me.jpg"}})],1)]:[n("v-uni-view",[n("v-uni-image",{staticClass:"new-img",attrs:{src:"/static/avatar.png"}}),n("v-uni-text",{staticClass:"new-txt new-text"},[t._v(t._s(e.content))])],1)]],2)}),1)],1)],1),n("v-uni-view",{staticClass:"message",style:t.devtools?"":"bottom:48px"},[n("v-uni-form",[n("v-uni-input",{attrs:{type:"text","cursor-spacing":"20",placeholder:"请输入聊天内容..."},on:{input:function(e){e=t.$handleEvent(e),t.bindChange(e)}}}),n("v-uni-button",{attrs:{type:"primary",formType:"reset",size:"small","button-hover":"blue"},on:{click:function(e){e=t.$handleEvent(e),t.send(e)}}},[t._v("发送")])],1)],1)],1)},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},"85c1":function(t,e,n){"use strict";n.r(e);var i=n("773e"),o=n("ba84");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("259d");var s=n("2877"),c=Object(s["a"])(o["default"],i["a"],i["b"],!1,null,"d3a7496c",null);e["default"]=c.exports},ba84:function(t,e,n){"use strict";n.r(e);var i=n("29c5"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a}}]);